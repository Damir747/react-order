**–ü–æ–ª–Ω–æ–µ —Ä–µ–∑—é–º–µ –ø–æ React commit-—Ñ–∞–∑–µ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º**.

---

## 1Ô∏è‚É£ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π —ç—Ñ—Ñ–µ–∫—Ç –∏ refCallback

# –í React –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –∏ callback refs. –í–æ—Ç –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

- **useInsertionEffect**

  - –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç **–ø–µ—Ä–µ–¥ DOM mutations**.
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è CSS-in-JS, —á—Ç–æ–±—ã –≤—Å—Ç–∞–≤–ª—è—Ç—å —Å—Ç–∏–ª–∏ –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –±—Ä–∞—É–∑–µ—Ä –æ—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç —ç–ª–µ–º–µ–Ω—Ç—ã.
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **bottom-up** (—Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ç–∏ ‚Üí –ø–æ—Ç–æ–º —Ä–æ–¥–∏—Ç–µ–ª–∏).

- **refCallback**

  - Callback ref, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–ø–æ—Å–ª–µ DOM mutations**, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç.
  - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏–π, —Ñ–æ–∫—É—Å–∞, –∞–Ω–∏–º–∞—Ü–∏–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏.
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **bottom-up** (—Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ç–∏ ‚Üí –ø–æ—Ç–æ–º —Ä–æ–¥–∏—Ç–µ–ª–∏).

- **useLayoutEffect**

  - –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç **–ø–æ—Å–ª–µ refCallback**, –Ω–æ **–¥–æ paint**.
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å DOM, –∏–∑–º–µ—Ä–µ–Ω–∏–π, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∞–Ω–∏–º–∞—Ü–∏–π.
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **bottom-up** (—Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ç–∏ ‚Üí –ø–æ—Ç–æ–º —Ä–æ–¥–∏—Ç–µ–ª–∏).

- **useEffect**
  - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç **–ø–æ—Å–ª–µ paint** (–ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∞ –Ω–∞ —ç–∫—Ä–∞–Ω).
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–¥–ø–∏—Å–æ–∫, —Ç–∞–π–º–µ—Ä–æ–≤.
  - –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **bottom-up** (—Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ç–∏ ‚Üí –ø–æ—Ç–æ–º —Ä–æ–¥–∏—Ç–µ–ª–∏).  
     |

---

## 2Ô∏è‚É£ –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ä–µ–≤–æ:

```
App
‚îú‚îÄ FirstComponent
‚îÇ  ‚îî‚îÄ SecondComponent
‚îî‚îÄ ThirdComponent
```

### üîπ Render phase (top-down)

```
0 App
1 FirstComponent
2 SecondComponent
3 ThirdComponent
```

### üîπ useInsertionEffect (bottom-up)

```
4 useInsertionEffect SecondComponent
5 useInsertionEffect FirstComponent
6 useInsertionEffect ThirdComponent
7 useInsertionEffect App
```

### üîπ refCallback ‚Üí useLayoutEffect (–∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ, bottom-up)

```
SecondComponent: 8 refCallback ‚Üí 9 useLayoutEffect
FirstComponent: 10 refCallback ‚Üí 11 useLayoutEffect
ThirdComponent: 12 refCallback ‚Üí 13 useLayoutEffect
App: 14 refCallback ‚Üí 15 useLayoutEffect
```

### üîπ useEffect (bottom-up, –ø–æ—Å–ª–µ paint)

```
16 useEffect SecondComponent
17 useEffect FirstComponent
18 useEffect ThirdComponent
19 useEffect App
```

---

## 3Ô∏è‚É£ –ß—Ç–æ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–æ –≤ –∫–æ–Ω—Å–æ–ª—å

–°–æ–±–∏—Ä–∞–µ–º –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ:

```
0 App
1 FirstComponent
2 SecondComponent
3 ThirdComponent
4 useInsertionEffect SecondComponent
5 useInsertionEffect FirstComponent
6 useInsertionEffect ThirdComponent
7 useInsertionEffect App
8 refCallback SecondComponent
9 useLayoutEffect SecondComponent
10 refCallback FirstComponent
11 useLayoutEffect FirstComponent
12 refCallback ThirdComponent
13 useLayoutEffect ThirdComponent
14 refCallback App
15 useLayoutEffect App
16 useEffect SecondComponent
17 useEffect FirstComponent
18 useEffect ThirdComponent
19 useEffect App
```

> –≠—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Ä–∞–∂–∞–µ—Ç **—Ä–µ–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –≤ React 18**, –≤–∫–ª—é—á–∞—è bottom-up –∏ —Ü–µ–ø–æ—á–∫—É **refCallback ‚Üí useLayoutEffect –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞**.

---

## 1Ô∏è‚É£ –ß—Ç–æ —Ç–∞–∫–æ–µ ¬´—Ä–µ–Ω–¥–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞¬ª –≤ React

- **Render phase** ‚Äî —ç—Ç–æ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è **–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π DOM**.

  - –õ–æ–≥–∏ —Ç–∏–ø–∞ `console.log("0 render App")` –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç **—Å—Ä–∞–∑—É**, –ø—Ä–∏ —ç—Ç–æ–º **DOM –≤ –±—Ä–∞—É–∑–µ—Ä–µ –µ—â—ë –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω**.
  - React –µ—â—ë **–Ω–µ —Å–¥–µ–ª–∞–ª paint** –Ω–∞ —ç–∫—Ä–∞–Ω ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏—á–µ–≥–æ –Ω–µ –≤–∏–¥–∏—Ç.

---

## 2Ô∏è‚É£ –ö–æ–≥–¥–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π DOM —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è ¬´–≤–∏–¥–∏–º—ã–º¬ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

- –ü–æ—Å–ª–µ **render phase** React –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ **commit phase**:

  1. –í—Å—Ç–∞–≤–ª—è—é—Ç—Å—è/–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ DOM-—É–∑–ª—ã (**DOM mutations**).
  2. –í—ã–ø–æ–ª–Ω—è—é—Ç—Å—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã**:

     - `useInsertionEffect`
     - `refCallback`
     - `useLayoutEffect`

- **–ü–æ–∫–∞ —ç—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –±—Ä–∞—É–∑–µ—Ä –Ω–µ –¥–µ–ª–∞–µ—Ç paint**, –ø–æ—ç—Ç–æ–º—É –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—â—ë –Ω–∏—á–µ–≥–æ –Ω–µ –≤–∏–¥–∏—Ç.

---

## 3Ô∏è‚É£ –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä –∏ useLayoutEffect

- **Commit phase –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è** –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **–≤—Å–µ—Ö layoutEffect**.
- –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç **–Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å DOM –Ω–∞ —ç–∫—Ä–∞–Ω–µ** ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
- –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ä–µ–Ω–¥–µ—Ä —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `0 render App` –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è **–ø–æ—Å–ª–µ–¥–Ω–∏–º useLayoutEffect** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `15 useLayoutEffect App`).

---

## 4Ô∏è‚É£ useEffect –∏ paint

- `useEffect` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –ø–æ—Å–ª–µ paint**.
- –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –≤—Å–µ DOM-–∏–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ –≤–∏–¥–Ω—ã, –∞ `useEffect` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–¥–ø–∏—Å–æ–∫, —Ç–∞–π–º–µ—Ä–æ–≤ –∏ —Ç.–¥.
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤–∏–¥–∏—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∫–æ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è `useEffect`.

---

## ‚úÖ –í—ã–≤–æ–¥

- **Render phase (`console.log("render")`)** ‚Üí –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ DOM, **–µ—â—ë –Ω–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ**.
- **Commit phase (useInsertionEffect ‚Üí (refCallback ‚Üí useLayoutEffect))** ‚Üí DOM –≤—Å—Ç–∞–≤–ª–µ–Ω –≤ –±—Ä–∞—É–∑–µ—Ä, layoutEffect –µ—â—ë –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è, paint –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω.
- **–í–∏–∑—É–∞–ª—å–Ω–æ —Ä–µ–Ω–¥–µ—Ä –∑–∞–≤–µ—Ä—à—ë–Ω** ‚Üí –ø–æ—Å–ª–µ **–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ useLayoutEffect**.
- **useEffect** ‚Üí —É–∂–µ –ø–æ—Å–ª–µ paint, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∏–¥–µ–Ω.
